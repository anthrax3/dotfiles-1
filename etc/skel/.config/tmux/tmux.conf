## prefixを C-z に変更 (default: C-b
set-option -g prefix C-z
bind C-z send-prefix
unbind C-b

unbind %
bind-key % split-window -h -c "#{pane_current_path}"
unbind '"'
bind-key '"' split-window -v -c "#{pane_current_path}"


## 基本設定
set-option -g default-terminal "xterm-256color"
set-option -gw utf8 on
set-option -gw automatic-rename off
# window/paneのイデックスを1から始める
set-option -g base-index 1
set-option -g pane-base-index 1
# ウィンドウが閉じられたらインデックス番号の隙間を詰める
set-option -g renumber-windows on
# 履歴を増やす
set-option -g history-limit 50000
# ESCの反応が遅くなる動作をさせない
set-option -s escape-time 0
# ファンクションキーが使えるようにする
set-option -g xterm-key on
# リピートタイムを無くす（事故の元なので）（default:500
set-option -g repeat-time 0
#メッセージの表示時間を延長
set-option -g display-time 1500
# ウィンドウマネージャ向けのタイトル
set-option -g set-titles on
set-option -g set-titles-string "[#S:#I:#P] #W - #T"
# ウィンドウ番号のリナンバリングを有効にする http://bit.ly/123VNxh
set-option -g renumber-windows on

# マウス関連（デフォルトはOFFにしておいて、prefix+mで切替える）http://bit.ly/Z8fLmm
set-option -g mouse off
bind-key m if-shell "tmux show-options -g mouse | grep off" "set-option -g mouse on" "set-option -g mouse off"

## ステータスライン改造
# ステータスラインの設定
set-option -g status on
set-option -g status-interval 2
set-option -g status-utf8 on
# tmux-powerline
set-option -g status-justify "centre"
set-option -g status-left-length 60
set-option -g status-right-length 90
set-option -g status-left  "#(~/.tmux/plugins/tmux-powerline/powerline.sh left)"
set-option -g status-right "#(~/.tmux/plugins/tmux-powerline/powerline.sh right)"
set-window-option -g window-status-current-format "#[fg=colour235, bg=colour27]⮀#[fg=colour255, bg=colour27] #I ⮁ #W #[fg=colour27, bg=colour235]⮀"

# # ステータスライン全体の見た目
# set-option -g status-attr none
# set-option -g status-bg magenta
# if-shell '[[ "$HOSTNAME" == "trooper" ]]' "set-option -g status-bg cyan"
# if-shell '[[ "${OSTYPE:0:6}" == "darwin" ]]' "set-option -g status-bg green"
# set-option -g status-fg black
# # ウィンドウリストの表示位置 [left/centre/right]
# set-option -g status-justify left
# set-option -g status-position bottom
# # ステータスラインの左側
# set-option -g status-left "[#S:#I.#P] "
# set-option -g status-left-length 10
# set-option -g status-left-attr none
# set-option -g status-left-bg default
# set-option -g status-left-fg default
# # ステータスラインの右側
# set-option -g status-right "#(echo $USER)@#h | %Y-%m-%d %H:%M:%S"
# set-option -g status-right-length 40
# set-option -g status-right-attr none
# set-option -g status-right-bg default
# set-option -g status-right-fg default
# # ステータスライン（ウィンドウ一覧のカレントウィンドウ以外）の見た目
# set-option -gw window-status-format "#F#I:#W"
# set-option -gw window-status-attr none
# set-option -gw window-status-bg default
# set-option -gw window-status-fg default
# # ステータスライン（ウィンドウ一覧のカレントウィンドウ部分）の見た目
# set-option -gw window-status-current-format "#(tmux show-window-options synchronize-panes | grep -q 'on$' && echo '#[fg=white,bg=red]')#F#I:#W"
# set-option -gw window-status-current-attr underscore,bold
# set-option -gw window-status-current-bg default
# set-option -gw window-status-current-fg white
# # ステータスライン（ウィンドウ名一覧の区切り文字）の見た目
# set-option -gw window-status-separator "  "
# # ステータスライン（ウィンドウ）の見た目
# set-option -gw window-status-activity-attr reverse
# set-option -gw window-status-activity-bg default
# set-option -gw window-status-activity-fg blue
# set-option -gw window-status-bell-attr reverse
# set-option -gw window-status-bell-bg default
# set-option -gw window-status-bell-fg red
# # window-status-content-* 系が2.0から無くなった？
# #set-option -gw window-status-content-attr reverse
# #set-option -gw window-status-content-bg default
# #set-option -gw window-status-content-fg cyan
# # メッセージの見た目
# set-option -g message-attr none
# set-option -g message-bg yellow
# set-option -g message-fg black
# # コマンドモードの見た目
# set-option -g message-command-attr none
# set-option -g message-command-bg black
# set-option -g message-command-fg yellow
# # ウィンドウモード（copyやchoice時の選択範囲や検索ワード入力部など）の見た目
# set-option -gw mode-attr none
# set-option -gw mode-bg yellow
# set-option -gw mode-fg black
# # paneの分割線の色
# set-option -g pane-active-border-bg default
# set-option -g pane-active-border-fg green
# set-option -g pane-border-bg default
# set-option -g pane-border-fg default


## キーバインド（デフォルト以外の割り当て
# prefix + r で設定ファイルを再読み込み
bind-key r source-file ~/.tmux.conf\; display-message "~/.tmux.conf reloaded."
# prefix + k/K でpane/windowをkillする
bind-key k kill-pane
bind-key K kill-window
# prefix + <> でウィンドウ移動
bind-key -r < previous-window
bind-key -r > next-window
bind-key -r C-h previous-window
bind-key -r C-j previous-window
bind-key -r C-k next-window
bind-key -r C-l next-window

## キーバインド
set-option -gw mode-keys vi
set-option -gw status-keys vi
# viモードにページ移動を追加
bind-key -t vi-copy C-Up page-up
bind-key -t vi-copy C-Down page-down
# 行コピーを追加
bind-key -t vi-copy Y copy-line
# 選択範囲をコピー
bind-key -t vi-copy y copy-selection
# ボックス選択
bind-key -t vi-copy C-v rectangle-toggle
# viモードにemacsキーバインドを混ぜる
bind-key -t vi-copy C-a start-of-line
bind-key -t vi-copy C-e end-of-line
bind-key -t vi-copy C-k copy-end-of-line
bind-key -t vi-edit C-a start-of-line
bind-key -t vi-edit C-d delete
bind-key -t vi-edit C-e end-of-line
bind-key -t vi-edit C-k delete-end-of-line
bind-key -t vi-edit C-u delete-line
bind-key -t vi-edit C-w delete-word
bind-key -t vi-edit C-y paste

## キーバインド（デフォルト割り当ての調整系
# 繰り返し使うことが多いのでリピートありにする（キー自体はデフォルトと同じ
bind-key -r p previous-window
bind-key -r n next-window
bind-key -r { swap-pane -U
bind-key -r } swap-pane -D
bind-key -r Space next-layout
# Alt+矢印でペインサイズ変更量を調整する(キー自体はデフォルトと同じ
bind-key -r M-Up resize-pane -U 1
bind-key -r M-Down resize-pane -D 1
bind-key -r M-Left resize-pane -L 2
bind-key -r M-Right resize-pane -R 2

## Mac用の追加設定を読み込む
source-file "$DOTFILES_DIR/.env/dest/tmux-platform.conf"

# When new plugin was added, send prefix+I for install.
set -g @tpm_plugins ' \
  tmux-plugins/tpm \
  tmux-plugins/tmux-open \
  erikw/tmux-powerline \
'
# Automatic tpm installation
if-shell '[[ ! -d $TMUX_PLUGIN_MANAGER_PATH/tpm ]]' 'run-shell "git clone https://github.com/tmux-plugins/tpm \"$TMUX_PLUGIN_MANAGER_PATH/tpm\" && \"$TMUX_PLUGIN_MANAGER_PATH\"/tpm/scripts/install_plugins.sh"'
# Initialize tpm
run-shell '"${TMUX_PLUGIN_MANAGER_PATH}/tpm/tpm"'

## メモ
#
# 分割線が崩れる
#   →PuTTYのWindow>Translation>CharacterSetでUTF-8じゃなくUTF-8(CJK)を使う
#
# 色が変
#   →~/.bashrcでexport TERM=screen-256colorする
#
# マウスが使えない
#   →PuTTYのWindow>Terminal>Features>Disable xterm-style mouse reportingのチェックを外す
#
# bind-keyで C-, とかは書けない。C-に繋げられるのは @[\]^_? の７文字だけで、それ以外は別名やエスケープ表記などもなく設定自体が行えない。(ver1.7
#
# 色の指定方法 http://bit.ly/XHZCpT
#

