#!/bin/bash
. "`dirname -- "$0"`"/functions.sh || exit

dest="$DOTFILES_DEST/bash-completion"

# for Mac
if is_mac; then
  # install
  brew install bash-completion
  # create startup script
  ( echo "# generated by $DOTFILES_DIR/bin/$(basename -- "$0")"
    echo 'if [ -r /usr/local/etc/bash_completion ]; then'
    echo '  . /usr/local/etc/bash_completion'
    echo 'fi'
  ) | make_profile_script 10-bash-completion.sh
  exit
fi

# 4.1未満の環境専用スクリプト
bash=${BASH_VERSION%.*}; bmajor=${bash%.*}; bminor=${bash#*.}
if [ $bmajor -lt 4 ] || [ $bmajor -eq 4 -a $bminor -lt 1 ]; then
  # bash < 4.1
  cd_tmpdir || exit 1
  curl http://bash-completion.alioth.debian.org/files/bash-completion-1.3.tar.bz2 | tar xj
  cd bash-completion-1.3 || exit 1
  ./configure --prefix="$dest" && make && make install
  # create startup script
  ( echo "# generated by $DOTFILES_DIR/bin/$(basename -- "$0")"
    echo "BASH_COMPLETION=\"$dest/etc/bash_completion\""
    echo "BASH_COMPLETION_DIR=\"$dest/etc/bash_completion.d\""
    echo "BASH_COMPLETION_COMPAT_DIR=\"$dest/etc/bash_completion.d\""
    echo "if [ -r \"$dest/etc/bash_completion\" ]; then"
    echo "  . \"$dest/etc/bash_completion\""
    echo "fi"
  ) | make_profile_script 10-bash-completion.sh
  exit
fi

# その他の環境
echo "このスクリプトが対象にしてる環境じゃないです"
exit 1
