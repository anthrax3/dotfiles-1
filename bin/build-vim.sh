#!/bin/bash
set -e
. "$(dirname -- "$0")"/functions.sh

dest="$DOTFILES_DEST/vim"

install_vim_mac() {
  brew install neovim
  pip3 install neovim --upgrade
}

install_vim_linux_yum() {
  sudo yum groups install -y 'Development tools'
  sudo yum install -y cmake
  if type -p pip3 2>/dev/null; then
    sudo pip3 install neovim --upgrade
  else
    py3_ver=$(yum list python3\*-pip -q | grep -Eo '^python3[0-9]+' | sort | tail -n1)
    sudo yum install -y "${py3_ver}"-{pip,devel}
    pip3=$(rpm -ql "${py3_ver}-pip" | grep -Eo '/bin/pip.*3.*' | head -n1)
    sudo "$pip3" install neovim --upgrade
  fi
  (
    cd "$(mktemp -d)" || exit 1
    trap "rm -rf $(printf %q "$(pwd)")" EXIT
    git clone https://github.com/neovim/neovim.git
    cd neovim
    make CMAKE_BUILD_TYPE=Release
    sudo make install
  )
  # # create startup script
  # ( echo "# generated by $DOTFILES_DIR/bin/$(basename -- "$0")"
  # echo "export PATH="$dest/bin:\$PATH""
  # ) | make_profile_script 10-vim.sh
}

if is_mac; then
  install_vim_mac
else
  install_vim_linux_yum
fi
