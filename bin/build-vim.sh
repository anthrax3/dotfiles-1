#!/bin/bash
. "`dirname -- "$0"`"/functions.sh || exit

src="$DOTFILES_SRC/vim"
dest="$DOTFILES_DEST/vim"

install_vim_mac() {
  brew install vim --with-lua --with-luajit
}

install_vim_linux_yum() {
  # 必要パッケージのチェック
  has_rpm_packages git gcc libselinux-devel lua-devel ncurses-devel || exit 1
  mkdir -p "$src"
  git clone "https://github.com/vim/vim.git" "$src"

  # get sources
  cd "$src" || exit 1
  git pull
  ./configure --prefix="$dest" \
    --enable-multibyte \
    --enable-pythoninterp \
    --enable-luainterp --with-lua-prefix=/usr \
    --with-features=huge \
    && make && make install || exit 1

  # create startup script
  ( echo "# generated by $DOTFILES_DIR/bin/$(basename -- "$0")"
  echo "export PATH="$dest/bin:\$PATH""
  ) | make_profile_script 10-vim.sh
}

if is_mac; then
  install_vim_mac
else
  install_vim_linux_yum
fi
